<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Captcha Tester — RPG IA</title>
  <style>
    body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial;margin:24px;background:#0f172a;color:#e6eef8}
    .card{background:#0b1220;padding:18px;border-radius:10px;box-shadow:0 6px 18px rgba(2,6,23,.6);max-width:820px;margin:12px auto}
    h1{margin:0 0 12px;font-size:20px}
    label{display:block;margin:10px 0 6px}
    select,input,button{padding:8px;border-radius:6px;border:1px solid #223;}
    button{cursor:pointer}
    .widget{margin-top:14px}
    .log{background:#071020;padding:10px;border-radius:6px;margin-top:12px;font-size:13px;color:#9fb7d8}
    .muted{color:#98a9c7;font-size:13px}
    .row{display:flex;gap:8px;align-items:center}
    small{color:#98a9c7}
  </style>
  <!-- reCAPTCHA v2 (test keys) -->
  <script src="https://www.google.com/recaptcha/api.js" async defer></script>
  <!-- hCaptcha (will load only se usar) -->
  <script src="https://hcaptcha.com/1/api.js" async defer></script>
  <!-- Cloudflare Turnstile (will load only se usar) -->
  <script src="https://challenges.cloudflare.com/turnstile/v0/api.js" async defer></script>
</head>
<body>
  <div class="card">
    <h1>Captcha Tester — RPG (IA adversária)</h1>
    <p class="muted">Modo de teste rápido para usar em mesas: simula/integra reCAPTCHA, hCaptcha e Turnstile. Use o <strong>Mock</strong> para partidas offline.</p>

    <label for="mode">Modo de teste</label>
    <select id="mode">
      <option value="mock">Mock (recomendado para usar na mesa)</option>
      <option value="recaptcha">Google reCAPTCHA v2 (chaves de teste)</option>
      <option value="hcaptcha">hCaptcha (use sua sitekey)</option>
      <option value="turnstile">Cloudflare Turnstile (testing keys)</option>
    </select>

    <div style="margin-top:10px">
      <label for="h_sitekey">hCaptcha sitekey (se usar hCaptcha)</label>
      <input id="h_sitekey" placeholder="coloque sua sitekey do hCaptcha aqui" style="width:100%" />
      <label for="t_sitekey" style="margin-top:8px">Turnstile sitekey (se usar Turnstile)</label>
      <input id="t_sitekey" placeholder="coloque sua sitekey do Turnstile aqui (ou use testing keys no docs)" style="width:100%" />
    </div>

    <div style="margin-top:12px" class="row">
      <button id="startBtn">Iniciar desafio</button>
      <button id="resetBtn" type="button">Reset</button>
      <small style="margin-left:auto">Versão de teste • Salve localmente</small>
    </div>

    <div id="widgetArea" class="widget"></div>

    <div class="log" id="log">
      <strong>Status:</strong> aguardando ação.
      <div id="statusDetail"></div>
    </div>

    <div style="margin-top:12px" class="muted">
      <strong>Dicas Rápidas para o RPG:</strong>
      <ul>
        <li>Use <em>Mock</em> para partidas rápidas: o mestre clica e recebe um resultado aleatório (passe/falha).</li>
        <li>Se quiser desafio real, abra a página com reCAPTCHA/hCaptcha/Turnstile e peça para o mestre resolver.</li>
        <li>Para testes automatizados, faça o servidor verificar os tokens (no exemplo local só simulamos a verificação).</li>
      </ul>
    </div>
  </div>

<script>
  // reCAPTCHA v2 test keys (Google fornece chaves de teste que sempre passam para dev).
  // Fonte: documentação oficial reCAPTCHA (usar só para desenvolvimento). 
  const RECAPTCHA_TEST_SITEKEY = "6LeIxAcTAAAAAJcZVRqyHh71UMIEGNQ_MXjiZKhI";

  const modeEl = document.getElementById('mode');
  const widgetArea = document.getElementById('widgetArea');
  const statusDetail = document.getElementById('statusDetail');
  const hSiteKeyInput = document.getElementById('h_sitekey');
  const tSiteKeyInput = document.getElementById('t_sitekey');

  let currentWidget = null;

  function log(text){
    statusDetail.innerHTML = text;
  }

  document.getElementById('startBtn').addEventListener('click', () => {
    const mode = modeEl.value;
    widgetArea.innerHTML = '';
    log('Iniciando: ' + mode);
    if(mode === 'mock'){
      renderMock();
    } else if(mode === 'recaptcha'){
      renderRecaptcha();
    } else if(mode === 'hcaptcha'){
      renderHcaptcha();
    } else if(mode === 'turnstile'){
      renderTurnstile();
    }
  });

  document.getElementById('resetBtn').addEventListener('click', () => {
    widgetArea.innerHTML = '';
    log('Resetado.');
  });

  // 1) Mock: botão que simula um desafio (útil para mesa sem Internet)
  function renderMock(){
    const btn = document.createElement('button');
    btn.textContent = 'Resolver (Mock)';
    btn.onclick = () => {
      // simula 70% de chance de sucesso
      const success = Math.random() < 0.7;
      if(success){
        log('Mock: sucesso — IA estabilizada, sem dano.');
      } else {
        log('Mock: falha — IA aplicada debuff.');
      }
    };
    widgetArea.appendChild(btn);
  }

  // 2) reCAPTCHA v2 (usa a chave de teste do Google)
  function renderRecaptcha(){
    const wrapper = document.createElement('div');
    wrapper.innerHTML = `<div class="g-recaptcha" data-sitekey="${RECAPTCHA_TEST_SITEKEY}"></div>
                         <div style="margin-top:8px"><button id="verifyRec">Verificar token (simulado)</button></div>`;
    widgetArea.appendChild(wrapper);
    // O Google carrega automaticamente o widget pela tag script incluída no <head>.
    // A verificação de token normalmente é feita no servidor; aqui apenas simulamos.
    setTimeout(()=>{ log('reCAPTCHA renderizado (test key). Resolva o desafio e clique em "Verificar token".'); },300);
    wrapper.querySelector('#verifyRec').addEventListener('click', ()=>{
      // no ambiente de dev com a test key, as verificações costumam passar; aqui mostramos mensagem.
      log('Verificação (simulada): token aceito — resultado: sucesso.');
    });
  }

  // 3) hCaptcha (carrega via script; requer sitekey)
  function renderHcaptcha(){
    const sitekey = hSiteKeyInput.value.trim();
    if(!sitekey){
      widgetArea.innerHTML = '<div class="muted">Insira sua <strong>hCaptcha sitekey</strong> no campo acima antes de iniciar.</div>';
      return;
    }
    const container = document.createElement('div');
    container.innerHTML = `<div class="h-captcha" data-sitekey="${sitekey}"></div>
                           <div style="margin-top:8px"><button id="verifyH">Verificar token (simulado)</button></div>`;
    widgetArea.appendChild(container);
    setTimeout(()=>{ log('hCaptcha renderizado. Resolva o desafio e clique em "Verificar token".'); },300);
    container.querySelector('#verifyH').addEventListener('click', ()=>{
      log('Verificação (simulada): token recebido. Em ambiente real, envie token ao seu servidor para verificar com secret key.');
    });
  }

  // 4) Turnstile (Cloudflare) — requires sitekey; in docs they mention testing keys and a testing flow
  function renderTurnstile(){
    const sitekey = tSiteKeyInput.value.trim();
    if(!sitekey){
      widgetArea.innerHTML = '<div class="muted">Insira sua <strong>Turnstile sitekey</strong> (ou consulte as testing keys no docs) no campo acima.</div>';
      return;
    }
    const id = 'cf-' + Math.random().toString(36).slice(2,9);
    const container = document.createElement('div');
    container.innerHTML = `<div id="${id}" class="cf-turnstile" data-sitekey="${sitekey}"></div>
                           <div style="margin-top:8px"><button id="verifyT">Verificar token (simulado)</button></div>`;
    widgetArea.appendChild(container);
    // Note: Turnstile auto-renders when the script is loaded. We just simulate server verification step here.
    setTimeout(()=>{ log('Turnstile renderizado. Resolva e clique em "Verificar token".'); },300);
    container.querySelector('#verifyT').addEventListener('click', ()=>{
      log('Verificação (simulada): token recebido. Em produção, seu servidor deve chamar o endpoint de verificação da Cloudflare.');
    });
  }
</script>
</body>
</html>
